<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŸºäºå·®åˆ†éšç§çš„åŒ»ç–—æ•°æ®ç»Ÿè®¡æŸ¥è¯¢ç³»ç»Ÿ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
            overflow: hidden;
            animation: fadeIn 0.8s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: pulse 4s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        
        .header h1 {
            font-size: 2.8em;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
        }
        
        .header p {
            font-size: 1.3em;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }
        
        .content {
            padding: 30px;
        }
        
        .section {
            margin-bottom: 30px;
            padding: 25px;
            border-radius: 15px;
            background: #f8f9fa;
            border-left: 5px solid #3498db;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .section:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.8em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .privacy-dashboard {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            position: relative;
        }
        
        .privacy-level {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .epsilon-display {
            font-size: 3em;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .privacy-strength {
            text-align: right;
        }
        
        .privacy-meter {
            width: 100%;
            height: 10px;
            background: rgba(255,255,255,0.3);
            border-radius: 10px;
            overflow: hidden;
            margin-top: 15px;
        }
        
        .privacy-fill {
            height: 100%;
            background: linear-gradient(90deg, #e74c3c 0%, #f39c12 50%, #27ae60 100%);
            border-radius: 10px;
            transition: width 0.5s ease;
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .control-group {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }
        
        .control-group:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.95em;
        }
        
        .control-group select,
        .control-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e8ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .control-group select:focus,
        .control-group input:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        .range-container {
            position: relative;
        }
        
        .range-value {
            position: absolute;
            right: 0;
            top: -25px;
            background: #3498db;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
        }
        
        .button {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 8px;
            position: relative;
            overflow: hidden;
        }
        
        .button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(52, 152, 219, 0.4);
        }
        
        .button:active {
            transform: translateY(-1px);
        }
        
        .button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .button:hover::before {
            left: 100%;
        }
        
        .button-group {
            text-align: center;
            margin: 20px 0;
        }
        
        .data-overview {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-item {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .stat-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #3498db;
            display: block;
            margin-bottom: 8px;
        }
        
        .stat-label {
            color: #7f8c8d;
            font-size: 0.9em;
            font-weight: 500;
        }
        
        .results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }
        
        .result-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border-top: 4px solid #e74c3c;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .result-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        }
        
        .result-card h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.4em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #ecf0f1;
        }
        
        .result-item:last-child {
            border-bottom: none;
        }
        
        .result-label {
            font-weight: 600;
            color: #34495e;
        }
        
        .result-value {
            font-size: 1.2em;
            font-weight: bold;
        }
        
        .true-value {
            color: #27ae60;
        }
        
        .private-value {
            color: #e74c3c;
        }
        
        .error-value {
            color: #f39c12;
        }
        
        .chart-container {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }
        
        .chart-canvas {
            max-height: 400px;
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 300px;
            background-color: #2c3e50;
            color: #fff;
            text-align: left;
            border-radius: 8px;
            padding: 15px;
            position: absolute;
            z-index: 1000;
            bottom: 125%;
            left: 50%;
            margin-left: -150px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.9em;
            line-height: 1.4;
        }
        
        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #2c3e50 transparent transparent transparent;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background: #ecf0f1;
            border-radius: 3px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2980b9);
            transition: width 0.5s ease;
        }
        
        .alert {
            padding: 15px 20px;
            margin: 15px 0;
            border-radius: 8px;
            font-weight: 500;
        }
        
        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 4px solid #17a2b8;
        }
        
        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border-left: 4px solid #ffc107;
        }
        
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-radius: 10px 10px 0 0;
            overflow: hidden;
            margin-bottom: 0;
        }
        
        .tab {
            flex: 1;
            padding: 15px 20px;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            color: #6c757d;
        }
        
        .tab.active {
            background: white;
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
        }
        
        .tab-content {
            background: white;
            padding: 25px;
            border-radius: 0 0 10px 10px;
            min-height: 200px;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .content {
                padding: 20px;
            }
            
            .controls {
                grid-template-columns: 1fr;
            }
            
            .results {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¥ å·®åˆ†éšç§åŒ»ç–—æ•°æ®æŸ¥è¯¢ç³»ç»Ÿ</h1>
            <p>åœ¨ä¸¥æ ¼ä¿æŠ¤æ‚£è€…éšç§çš„åŒæ—¶æä¾›å‡†ç¡®çš„åŒ»ç–—ç»Ÿè®¡ä¿¡æ¯</p>
        </div>
        
        <div class="content">
            <!-- éšç§ä»ªè¡¨æ¿ -->
            <div class="section">
                <div class="privacy-dashboard">
                    <div class="privacy-level">
                        <div>
                            <h3>ğŸ”’ å½“å‰éšç§ä¿æŠ¤çº§åˆ«</h3>
                            <div class="epsilon-display">Îµ = <span id="epsilonValue">1.0</span></div>
                        </div>
                        <div class="privacy-strength">
                            <div id="privacyStrength">ä¸­ç­‰ä¿æŠ¤</div>
                            <div style="font-size: 0.9em; opacity: 0.8;">éšç§é¢„ç®—ä½™é¢: <span id="budgetRemaining">100%</span></div>
                        </div>
                    </div>
                    <div class="privacy-meter">
                        <div class="privacy-fill" id="privacyMeter"></div>
                    </div>
                    <div class="alert alert-info" style="margin-top: 15px; background: rgba(255,255,255,0.1); color: white; border-left-color: rgba(255,255,255,0.3);">
                        <strong>å·®åˆ†éšç§åŸç†ï¼š</strong>é€šè¿‡å‘æŸ¥è¯¢ç»“æœæ·»åŠ æ ¡å‡†çš„éšæœºå™ªå£°ï¼Œç¡®ä¿ä»»ä½•å•ä¸ªæ‚£è€…çš„ä¿¡æ¯éƒ½æ— æ³•è¢«æ¨æ–­å‡ºæ¥ã€‚Îµå€¼è¶Šå°ï¼Œéšç§ä¿æŠ¤è¶Šå¼ºï¼Œä½†æŸ¥è¯¢ç»“æœçš„è¯¯å·®ä¹Ÿè¶Šå¤§ã€‚
                    </div>
                </div>
            </div>

            <!-- æ§åˆ¶é¢æ¿ -->
            <div class="section">
                <h2>âš™ï¸ æŸ¥è¯¢é…ç½®</h2>
                <div class="controls">
                    <div class="control-group">
                        <label for="epsilon" class="tooltip">
                            éšç§å‚æ•° Îµ
                            <span class="tooltiptext">
                                <strong>éšç§å‚æ•° Îµ çš„å«ä¹‰ï¼š</strong><br>
                                â€¢ Îµ â‰¤ 0.5: æå¼ºéšç§ä¿æŠ¤ï¼Œé«˜å™ªå£°<br>
                                â€¢ 0.5 < Îµ â‰¤ 1.0: å¼ºéšç§ä¿æŠ¤ï¼Œä¸­ç­‰å™ªå£°<br>
                                â€¢ 1.0 < Îµ â‰¤ 2.0: ä¸­ç­‰éšç§ä¿æŠ¤ï¼Œè¾ƒä½å™ªå£°<br>
                                â€¢ Îµ > 2.0: è¾ƒå¼±éšç§ä¿æŠ¤ï¼Œä½å™ªå£°
                            </span>
                        </label>
                        <div class="range-container">
                            <input type="range" id="epsilon" min="0.1" max="5.0" step="0.1" value="1.0">
                            <div class="range-value" id="epsilonRange">1.0</div>
                        </div>
                    </div>
                    
                    <div class="control-group">
                        <label for="queryType" class="tooltip">
                            æŸ¥è¯¢ç±»å‹
                            <span class="tooltiptext">
                                <strong>æ”¯æŒçš„æŸ¥è¯¢ç±»å‹ï¼š</strong><br>
                                â€¢ è®¡æ•°æŸ¥è¯¢ï¼šç»Ÿè®¡æ»¡è¶³æ¡ä»¶çš„è®°å½•æ•°é‡<br>
                                â€¢ å¹³å‡å€¼æŸ¥è¯¢ï¼šè®¡ç®—æŒ‡å®šåˆ—çš„å¹³å‡å€¼<br>
                                â€¢ æ±‚å’ŒæŸ¥è¯¢ï¼šè®¡ç®—æŒ‡å®šåˆ—çš„æ€»å’Œ<br>
                                â€¢ æœ€å€¼æŸ¥è¯¢ï¼šæ‰¾å‡ºæœ€å¤§å€¼æˆ–æœ€å°å€¼
                            </span>
                        </label>
                        <select id="queryType">
                            <option value="count">è®¡æ•°æŸ¥è¯¢</option>
                            <option value="mean">å¹³å‡å€¼æŸ¥è¯¢</option>
                            <option value="sum">æ±‚å’ŒæŸ¥è¯¢</option>
                            <option value="min">æœ€å°å€¼æŸ¥è¯¢</option>
                            <option value="max">æœ€å¤§å€¼æŸ¥è¯¢</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label for="column" class="tooltip">
                            ç›®æ ‡åˆ—
                            <span class="tooltiptext">
                                <strong>å¯æŸ¥è¯¢çš„æ•°æ®åˆ—ï¼š</strong><br>
                                â€¢ å¹´é¾„ï¼šæ‚£è€…å¹´é¾„ï¼ˆ18-100å²ï¼‰<br>
                                â€¢ è¡€å‹ï¼šæ”¶ç¼©å‹æ•°å€¼ï¼ˆ80-200 mmHgï¼‰<br>
                                â€¢ èƒ†å›ºé†‡ï¼šæ€»èƒ†å›ºé†‡æ°´å¹³ï¼ˆ120-400 mg/dLï¼‰<br>
                                â€¢ è¡€ç³–ï¼šç©ºè…¹è¡€ç³–å€¼ï¼ˆ60-300 mg/dLï¼‰<br>
                                â€¢ BMIï¼šèº«ä½“è´¨é‡æŒ‡æ•°ï¼ˆ15-50ï¼‰
                            </span>
                        </label>
                        <select id="column">
                            <option value="age">å¹´é¾„ (å²)</option>
                            <option value="blood_pressure">è¡€å‹ (mmHg)</option>
                            <option value="cholesterol">èƒ†å›ºé†‡ (mg/dL)</option>
                            <option value="glucose">è¡€ç³– (mg/dL)</option>
                            <option value="bmi">BMIæŒ‡æ•°</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label for="condition" class="tooltip">
                            ç­›é€‰æ¡ä»¶
                            <span class="tooltiptext">
                                <strong>æ”¯æŒçš„ç­›é€‰æ¡ä»¶ï¼š</strong><br>
                                â€¢ æ— æ¡ä»¶ï¼šæŸ¥è¯¢æ‰€æœ‰æ‚£è€…<br>
                                â€¢ ç–¾ç—…ç­›é€‰ï¼šæŒ‰ç‰¹å®šç–¾ç—…ç±»å‹ç­›é€‰<br>
                                â€¢ å¹´é¾„ç­›é€‰ï¼šæŒ‰å¹´é¾„æ®µç­›é€‰<br>
                                â€¢ æ€§åˆ«ç­›é€‰ï¼šæŒ‰æ€§åˆ«ç­›é€‰
                            </span>
                        </label>
                        <select id="condition">
                            <option value="none">æ— æ¡ä»¶</option>
                            <option value="diabetes">ç³–å°¿ç—…æ‚£è€…</option>
                            <option value="hypertension">é«˜è¡€å‹æ‚£è€…</option>
                            <option value="hyperlipidemia">é«˜è¡€è„‚æ‚£è€…</option>
                            <option value="cardiovascular">å¿ƒè¡€ç®¡ç–¾ç—…æ‚£è€…</option>
                            <option value="elderly">è€å¹´æ‚£è€… (>60å²)</option>
                            <option value="young">å¹´è½»æ‚£è€… (<40å²)</option>
                            <option value="male">ç”·æ€§æ‚£è€…</option>
                            <option value="female">å¥³æ€§æ‚£è€…</option>
                        </select>
                    </div>
                </div>
                
                <div class="button-group">
                    <button class="button" onclick="generateData()">ğŸ”„ ç”Ÿæˆæ–°æ•°æ®é›†</button>
                    <button class="button" onclick="executeQuery()">ğŸ” æ‰§è¡ŒæŸ¥è¯¢</button>
                    <button class="button" onclick="comparePrivacyLevels()">ğŸ“Š éšç§çº§åˆ«å¯¹æ¯”</button>
                    <button class="button" onclick="showPrivacyTrend()">ğŸ“ˆ éšç§-æ•ˆç”¨è¶‹åŠ¿</button>
                    <button class="button" onclick="clearResults()">ğŸ—‘ï¸ æ¸…é™¤ç»“æœ</button>
                </div>
            </div>

            <!-- æ•°æ®æ¦‚è§ˆ -->
            <div class="section">
                <h2>ğŸ“‹ æ•°æ®é›†æ¦‚è§ˆ</h2>
                <div class="data-overview">
                    <p>å½“å‰æ•°æ®é›†åŒ…å« <strong id="totalRecords">0</strong> æ¡æ‚£è€…è®°å½•ï¼Œæ¶µç›–å¤šé¡¹å¥åº·æŒ‡æ ‡å’Œç–¾ç—…è¯Šæ–­ä¿¡æ¯ã€‚</p>
                    <div class="stats-grid" id="dataStats">
                        <!-- åŠ¨æ€ç”Ÿæˆæ•°æ®ç»Ÿè®¡ -->
                    </div>
                </div>
            </div>

            <!-- ç»“æœå±•ç¤º -->
            <div class="section">
                <h2>ğŸ“ˆ æŸ¥è¯¢ç»“æœä¸åˆ†æ</h2>
                
                <!-- æ ‡ç­¾é¡µ -->
                <div class="tabs">
                    <button class="tab active" onclick="showTab('results')">æŸ¥è¯¢ç»“æœ</button>
                    <button class="tab" onclick="showTab('charts')">å¯è§†åŒ–åˆ†æ</button>
                    <button class="tab" onclick="showTab('history')">æŸ¥è¯¢å†å²</button>
                    <button class="tab" onclick="showTab('explanation')">ç»“æœè§£é‡Š</button>
                </div>
                
                <div class="tab-content">
                    <!-- æŸ¥è¯¢ç»“æœæ ‡ç­¾é¡µ -->
                    <div id="results-tab" class="tab-panel">
                        <div class="results" id="queryResults">
                            <div class="result-card">
                                <h3>ğŸ’¡ ä½¿ç”¨è¯´æ˜</h3>
                                <div class="alert alert-info">
                                    <strong>å¼€å§‹ä½¿ç”¨ï¼š</strong><br>
                                    1. é¦–å…ˆç‚¹å‡»"ç”Ÿæˆæ–°æ•°æ®é›†"åˆ›å»ºæ¨¡æ‹ŸåŒ»ç–—æ•°æ®<br>
                                    2. è°ƒæ•´éšç§å‚æ•°Îµå’ŒæŸ¥è¯¢é…ç½®<br>
                                    3. ç‚¹å‡»"æ‰§è¡ŒæŸ¥è¯¢"æŸ¥çœ‹ç»“æœ<br>
                                    4. å°è¯•ä¸åŒçš„éšç§çº§åˆ«å¯¹æ¯”æ•ˆæœ
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- å¯è§†åŒ–åˆ†ææ ‡ç­¾é¡µ -->
                    <div id="charts-tab" class="tab-panel hidden">
                        <div class="chart-container">
                            <h3>éšç§-æ•ˆç”¨æƒè¡¡æ›²çº¿</h3>
                            <canvas id="privacyChart" class="chart-canvas"></canvas>
                        </div>
                        <div class="chart-container">
                            <h3>æ•°æ®åˆ†å¸ƒå¯è§†åŒ–</h3>
                            <canvas id="distributionChart" class="chart-canvas"></canvas>
                        </div>
                    </div>
                    
                    <!-- æŸ¥è¯¢å†å²æ ‡ç­¾é¡µ -->
                    <div id="history-tab" class="tab-panel hidden">
                        <div id="queryHistory">
                            <p class="text-muted">æš‚æ— æŸ¥è¯¢å†å²è®°å½•ã€‚æ‰§è¡ŒæŸ¥è¯¢åï¼Œå†å²è®°å½•å°†æ˜¾ç¤ºåœ¨è¿™é‡Œã€‚</p>
                        </div>
                    </div>
                    
                    <!-- ç»“æœè§£é‡Šæ ‡ç­¾é¡µ -->
                    <div id="explanation-tab" class="tab-panel hidden">
                        <div id="resultExplanation">
                            <h3>ğŸ¯ å¦‚ä½•ç†è§£æŸ¥è¯¢ç»“æœ</h3>
                            <div class="alert alert-info">
                                æ‰§è¡ŒæŸ¥è¯¢åï¼Œè¿™é‡Œå°†æ˜¾ç¤ºè¯¦ç»†çš„ç»“æœè§£é‡Šå’Œéšç§ä¿æŠ¤æ•ˆæœåˆ†æã€‚
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let medicalData = [];
        let dpSystem = null;
        let queryHistory = [];
        let privacyBudgetUsed = 0;
        let charts = {};

        // å·®åˆ†éšç§ç³»ç»Ÿç±»
        class DifferentialPrivacySystem {
            constructor(epsilon = 1.0) {
                this.epsilon = epsilon;
                this.data = [];
                this.queryCount = 0;
            }
            
            setEpsilon(epsilon) {
                this.epsilon = parseFloat(epsilon);
            }
            
            loadData(data) {
                this.data = data;
            }
            
            calculateSensitivity(queryType, column = null) {
                if (queryType === 'count') {
                    return 1.0;
                } else if (['sum', 'mean', 'min', 'max'].includes(queryType)) {
                    if (!column) return 1.0;
                    
                    const values = this.data.map(row => row[column]).filter(v => !isNaN(v));
                    if (values.length === 0) return 1.0;
                    
                    const max = Math.max(...values);
                    const min = Math.min(...values);
                    
                    if (queryType === 'sum') {
                        return max - min;
                    } else if (queryType === 'mean') {
                        return (max - min) / this.data.length;
                    } else if (queryType === 'min' || queryType === 'max') {
                        return max - min;
                    }
                }
                return 1.0;
            }
            
            addLaplaceNoise(trueResult, sensitivity) {
                const scale = sensitivity / this.epsilon;
                const u1 = Math.random();
                const noise = u1 > 0.5 ? 
                    -scale * Math.log(2 * (1 - u1)) : 
                    scale * Math.log(2 * u1);
                
                return trueResult + noise;
            }
            
            applyCondition(condition) {
                let filteredData = [...this.data];
                
                switch(condition) {
                    case 'diabetes':
                        filteredData = filteredData.filter(row => row.disease === 'diabetes');
                        break;
                    case 'hypertension':
                        filteredData = filteredData.filter(row => row.disease === 'hypertension');
                        break;
                    case 'hyperlipidemia':
                        filteredData = filteredData.filter(row => row.disease === 'hyperlipidemia');
                        break;
                    case 'cardiovascular':
                        filteredData = filteredData.filter(row => row.disease === 'cardiovascular');
                        break;
                    case 'elderly':
                        filteredData = filteredData.filter(row => row.age > 60);
                        break;
                    case 'young':
                        filteredData = filteredData.filter(row => row.age < 40);
                        break;
                    case 'male':
                        filteredData = filteredData.filter(row => row.gender === 'M');
                        break;
                    case 'female':
                        filteredData = filteredData.filter(row => row.gender === 'F');
                        break;
                    default:
                        break;
                }
                
                return filteredData;
            }
            
            executeQuery(queryType, column = null, condition = 'none') {
                const filteredData = this.applyCondition(condition);
                let trueResult = 0;
                
                if (queryType === 'count') {
                    trueResult = filteredData.length;
                } else if (queryType === 'sum') {
                    trueResult = filteredData.reduce((sum, row) => sum + (row[column] || 0), 0);
                } else if (queryType === 'mean') {
                    if (filteredData.length === 0) return { trueResult: 0, privateResult: 0, sensitivity: 0, relativeError: 0 };
                    trueResult = filteredData.reduce((sum, row) => sum + (row[column] || 0), 0) / filteredData.length;
                } else if (queryType === 'min') {
                    if (filteredData.length === 0) return { trueResult: 0, privateResult: 0, sensitivity: 0, relativeError: 0 };
                    trueResult = Math.min(...filteredData.map(row => row[column] || 0));
                } else if (queryType === 'max') {
                    if (filteredData.length === 0) return { trueResult: 0, privateResult: 0, sensitivity: 0, relativeError: 0 };
                    trueResult = Math.max(...filteredData.map(row => row[column] || 0));
                }
                
                const sensitivity = this.calculateSensitivity(queryType, column);
                const privateResult = this.addLaplaceNoise(trueResult, sensitivity);
                
                this.queryCount++;
                
                return {
                    trueResult,
                    privateResult: Math.max(0, privateResult),
                    sensitivity,
                    relativeError: trueResult > 0 ? Math.abs(trueResult - privateResult) / trueResult : 0,
                    filteredCount: filteredData.length
                };
            }
        }
        
        // ç”Ÿæˆæ­£æ€åˆ†å¸ƒéšæœºæ•°
        function normalRandom(mean, std) {
            const u1 = Math.random();
            const u2 = Math.random();
            const z0 = Math.sqrt(-2 * Math.log(u1)) * Math.cos(2 * Math.PI * u2);
            return z0 * std + mean;
        }
        
        // ç”Ÿæˆæ¨¡æ‹ŸåŒ»ç–—æ•°æ®
        function generateMedicalData(nPatients = 1500) {
            const data = [];
            
            for (let i = 0; i < nPatients; i++) {
                const age = Math.max(18, Math.min(100, Math.round(normalRandom(52, 22))));
                const gender = Math.random() > 0.48 ? 'F' : 'M';
                const bloodPressure = Math.max(80, Math.min(200, Math.round(normalRandom(115 + (age - 30) * 0.4, 18))));
                const cholesterol = Math.max(120, Math.min(400, Math.round(normalRandom(175 + (age - 30) * 0.5, 35))));
                const glucose = Math.max(60, Math.min(300, Math.round(normalRandom(92 + (age - 40) * 0.2, 22))));
                const bmi = Math.max(15, Math.min(50, Math.round(normalRandom(24.5 + (age - 40) * 0.05, 5.5) * 10) / 10));
                
                let disease = 'healthy';
                const ageRisk = age > 55 ? (age - 55) / 45 : 0;
                const bpRisk = bloodPressure > 130 ? (bloodPressure - 130) / 70 : 0;
                const glucoseRisk = glucose > 100 ? (glucose - 100) / 200 : 0;
                const cholRisk = cholesterol > 200 ? (cholesterol - 200) / 200 : 0;
                
                const totalRisk = ageRisk + bpRisk + glucoseRisk + cholRisk;
                const random = Math.random();
                
                if (totalRisk > 1.5 && random < 0.3) {
                    if (bloodPressure > 140) disease = 'hypertension';
                    else if (glucose > 126) disease = 'diabetes';
                    else if (cholesterol > 240) disease = 'hyperlipidemia';
                    else if (age > 65) disease = 'cardiovascular';
                } else if (totalRisk > 1.0 && random < 0.2) {
                    if (glucose > 126) disease = 'diabetes';
                    else if (cholesterol > 240) disease = 'hyperlipidemia';
                    else if (bloodPressure > 140) disease = 'hypertension';
                } else if (totalRisk > 0.5 && random < 0.1) {
                    const diseases = ['diabetes', 'hyperlipidemia', 'hypertension'];
                    disease = diseases[Math.floor(Math.random() * diseases.length)];
                }
                
                data.push({
                    patientId: i + 1,
                    age,
                    gender,
                    blood_pressure: bloodPressure,
                    cholesterol,
                    glucose,
                    bmi,
                    disease
                });
            }
            
            return data;
        }
        
        // åˆå§‹åŒ–ç³»ç»Ÿ
        function initSystem() {
            dpSystem = new DifferentialPrivacySystem(1.0);
            updateEpsilonDisplay();
            updatePrivacyMeter();
            
            // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            document.getElementById('epsilon').addEventListener('input', function() {
                const epsilon = parseFloat(this.value);
                dpSystem.setEpsilon(epsilon);
                updateEpsilonDisplay();
                updatePrivacyMeter();
                updatePrivacyBudget();
            });
            
            document.getElementById('queryType').addEventListener('change', updateColumnVisibility);
            updateColumnVisibility();
        }
        
        // æ›´æ–°éšç§å‚æ•°æ˜¾ç¤º
        function updateEpsilonDisplay() {
            const epsilon = document.getElementById('epsilon').value;
            document.getElementById('epsilonValue').textContent = epsilon;
            document.getElementById('epsilonRange').textContent = epsilon;
            
            let strengthText = '';
            let strengthColor = '';
            
            if (epsilon <= 0.5) {
                strengthText = 'æå¼ºä¿æŠ¤';
                strengthColor = '#e74c3c';
            } else if (epsilon <= 1.0) {
                strengthText = 'å¼ºä¿æŠ¤';
                strengthColor = '#f39c12';
            } else if (epsilon <= 2.0) {
                strengthText = 'ä¸­ç­‰ä¿æŠ¤';
                strengthColor = '#3498db';
            } else if (epsilon <= 3.0) {
                strengthText = 'è¾ƒå¼±ä¿æŠ¤';
                strengthColor = '#95a5a6';
            } else {
                strengthText = 'å¼±ä¿æŠ¤';
                strengthColor = '#27ae60';
            }
            
            const strengthElement = document.getElementById('privacyStrength');
            strengthElement.textContent = strengthText;
            strengthElement.style.color = strengthColor;
        }
        
        // æ›´æ–°éšç§ä»ªè¡¨
        function updatePrivacyMeter() {
            const epsilon = parseFloat(document.getElementById('epsilon').value);
            const percentage = Math.max(0, Math.min(100, (5 - epsilon) / 4.9 * 100));
            document.getElementById('privacyMeter').style.width = percentage + '%';
        }
        
        // æ›´æ–°éšç§é¢„ç®—
        function updatePrivacyBudget() {
            const remaining = Math.max(0, 100 - privacyBudgetUsed);
            document.getElementById('budgetRemaining').textContent = remaining.toFixed(1) + '%';
        }
        
        // æ›´æ–°åˆ—æ˜¾ç¤º
        function updateColumnVisibility() {
            const queryType = document.getElementById('queryType').value;
            const columnGroup = document.getElementById('column').closest('.control-group');
            
            if (queryType === 'count') {
                columnGroup.style.opacity = '0.5';
                columnGroup.style.pointerEvents = 'none';
            } else {
                columnGroup.style.opacity = '1';
                columnGroup.style.pointerEvents = 'auto';
            }
        }
        
        // ç”Ÿæˆæ–°æ•°æ®
        function generateData() {
            const button = event.target;
            const originalText = button.innerHTML;
            button.innerHTML = '<span class="loading"></span>ç”Ÿæˆä¸­...';
            button.disabled = true;
            
            setTimeout(() => {
                medicalData = generateMedicalData(1500);
                dpSystem.loadData(medicalData);
                displayDataOverview();
                
                button.innerHTML = originalText;
                button.disabled = false;
                
                showNotification('âœ… æˆåŠŸç”Ÿæˆ1500æ¡æ‚£è€…è®°å½•', 'success');
            }, 1000);
        }
        
        // æ˜¾ç¤ºæ•°æ®æ¦‚è§ˆ
        function displayDataOverview() {
            document.getElementById('totalRecords').textContent = medicalData.length;
            
            const diseases = {};
            let totalAge = 0;
            let totalBP = 0;
            let maleCount = 0;
            
            medicalData.forEach(patient => {
                diseases[patient.disease] = (diseases[patient.disease] || 0) + 1;
                totalAge += patient.age;
                totalBP += patient.blood_pressure;
                if (patient.gender === 'M') maleCount++;
            });
            
            const diseaseEntries = Object.entries(diseases).sort((a, b) => b[1] - a[1]);
            const topDisease = diseaseEntries[0];
            
            const statsHTML = `
                <div class="stat-item" onclick="showDataDetail('total')">
                    <span class="stat-number">${medicalData.length}</span>
                    <div class="stat-label">æ€»æ‚£è€…æ•°</div>
                </div>
                <div class="stat-item" onclick="showDataDetail('age')">
                    <span class="stat-number">${Math.round(totalAge / medicalData.length)}</span>
                    <div class="stat-label">å¹³å‡å¹´é¾„</div>
                </div>
                <div class="stat-item" onclick="showDataDetail('gender')">
                    <span class="stat-number">${Math.round(maleCount / medicalData.length * 100)}%</span>
                    <div class="stat-label">ç”·æ€§æ¯”ä¾‹</div>
                </div>
                <div class="stat-item" onclick="showDataDetail('bp')">
                    <span class="stat-number">${Math.round(totalBP / medicalData.length)}</span>
                    <div class="stat-label">å¹³å‡è¡€å‹</div>
                </div>
                <div class="stat-item" onclick="showDataDetail('disease')">
                    <span class="stat-number">${topDisease ? topDisease[1] : 0}</span>
                    <div class="stat-label">${getDiseaseName(topDisease ? topDisease[0] : 'healthy')}</div>
                </div>
            `;
            
            document.getElementById('dataStats').innerHTML = statsHTML;
            
            updateDistributionChart();
        }
        
        // è·å–ç–¾ç—…ä¸­æ–‡å
        function getDiseaseName(disease) {
            const names = {
                'healthy': 'å¥åº·äººç¾¤',
                'diabetes': 'ç³–å°¿ç—…',
                'hypertension': 'é«˜è¡€å‹',
                'hyperlipidemia': 'é«˜è¡€è„‚',
                'cardiovascular': 'å¿ƒè¡€ç®¡ç—…'
            };
            return names[disease] || disease;
        }
        
        // æ‰§è¡ŒæŸ¥è¯¢
        function executeQuery() {
            if (!medicalData.length) {
                showNotification('âš ï¸ è¯·å…ˆç”Ÿæˆæ•°æ®é›†', 'warning');
                return;
            }
            
            const queryType = document.getElementById('queryType').value;
            const column = document.getElementById('column').value;
            const condition = document.getElementById('condition').value;
            
            const button = event.target;
            const originalText = button.innerHTML;
            button.innerHTML = '<span class="loading"></span>æŸ¥è¯¢ä¸­...';
            button.disabled = true;
            
            setTimeout(() => {
                const result = dpSystem.executeQuery(queryType, column, condition);
                displayQueryResult(result, queryType, column, condition);
                addToHistory(result, queryType, column, condition);
                updatePrivacyBudgetUsage();
                
                button.innerHTML = originalText;
                button.disabled = false;
                
                showNotification('âœ… æŸ¥è¯¢æ‰§è¡Œå®Œæˆ', 'success');
            }, 800);
        }
        
        // æ˜¾ç¤ºæŸ¥è¯¢ç»“æœ
        function displayQueryResult(result, queryType, column, condition) {
            const queryTypeNames = {
                'count': 'è®¡æ•°æŸ¥è¯¢',
                'mean': 'å¹³å‡å€¼æŸ¥è¯¢',
                'sum': 'æ±‚å’ŒæŸ¥è¯¢',
                'min': 'æœ€å°å€¼æŸ¥è¯¢',
                'max': 'æœ€å¤§å€¼æŸ¥è¯¢'
            };
            
            const columnNames = {
                'age': 'å¹´é¾„',
                'blood_pressure': 'è¡€å‹',
                'cholesterol': 'èƒ†å›ºé†‡',
                'glucose': 'è¡€ç³–',
                'bmi': 'BMI'
            };
            
            const conditionNames = {
                'none': 'æ— æ¡ä»¶',
                'diabetes': 'ç³–å°¿ç—…æ‚£è€…',
                'hypertension': 'é«˜è¡€å‹æ‚£è€…',
                'hyperlipidemia': 'é«˜è¡€è„‚æ‚£è€…',
                'cardiovascular': 'å¿ƒè¡€ç®¡ç–¾ç—…æ‚£è€…',
                'elderly': 'è€å¹´æ‚£è€…(>60å²)',
                'young': 'å¹´è½»æ‚£è€…(<40å²)',
                'male': 'ç”·æ€§æ‚£è€…',
                'female': 'å¥³æ€§æ‚£è€…'
            };
            
            const errorLevel = result.relativeError < 0.05 ? 'low' : result.relativeError < 0.15 ? 'medium' : 'high';
            const errorColor = errorLevel === 'low' ? '#27ae60' : errorLevel === 'medium' ? '#f39c12' : '#e74c3c';
            
            const resultHTML = `
                <div class="result-card" style="border-top-color: ${errorColor}">
                    <h3>ğŸ” æŸ¥è¯¢ç»“æœ</h3>
                    <div class="result-item">
                        <span class="result-label">æŸ¥è¯¢ç±»å‹:</span>
                        <span>${queryTypeNames[queryType]}${queryType !== 'count' ? ' - ' + columnNames[column] : ''}</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">ç­›é€‰æ¡ä»¶:</span>
                        <span>${conditionNames[condition]}</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">åŒ¹é…è®°å½•æ•°:</span>
                        <span>${result.filteredCount}</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">çœŸå®å€¼:</span>
                        <span class="result-value true-value">${formatNumber(result.trueResult)}</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">éšç§ä¿æŠ¤å€¼:</span>
                        <span class="result-value private-value">${formatNumber(result.privateResult)}</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">ç›¸å¯¹è¯¯å·®:</span>
                        <span class="result-value error-value" style="color: ${errorColor}">${(result.relativeError * 100).toFixed(2)}%</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">æ•æ„Ÿåº¦:</span>
                        <span class="result-value">${result.sensitivity.toFixed(3)}</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">éšç§å‚æ•°:</span>
                        <span class="result-value">Îµ = ${dpSystem.epsilon}</span>
                    </div>
                </div>
                
                <div class="result-card">
                    <h3>ğŸ“Š ç»“æœåˆ†æ</h3>
                    <div class="alert ${getErrorAlertClass(result.relativeError)}">
                        <strong>ç²¾åº¦è¯„ä¼°:</strong> ${getAccuracyDescription(result.relativeError)}<br>
                        <strong>éšç§ä¿æŠ¤:</strong> ${getPrivacyDescription(dpSystem.epsilon)}<br>
                        <strong>å»ºè®®:</strong> ${getRecommendation(result.relativeError, dpSystem.epsilon)}
                    </div>
                    <div style="margin-top: 15px;">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${Math.min(100, result.relativeError * 500)}%"></div>
                        </div>
                        <small>è¯¯å·®æ°´å¹³æŒ‡ç¤ºå™¨</small>
                    </div>
                </div>
            `;
            
            document.getElementById('queryResults').innerHTML = resultHTML;
            updateResultExplanation(result, queryType, column, condition);
        }
        
        // æ ¼å¼åŒ–æ•°å­—
        function formatNumber(num) {
            if (num === null || num === undefined) return 'N/A';
            if (Math.abs(num) < 0.01) return num.toExponential(2);
            if (Number.isInteger(num)) return num.toString();
            return num.toFixed(2);
        }
        
        // è·å–è¯¯å·®è­¦å‘Šç±»
        function getErrorAlertClass(error) {
            return error < 0.05 ? 'alert-info' : 'alert-warning';
        }
        
        // è·å–ç²¾åº¦æè¿°
        function getAccuracyDescription(error) {
            if (error < 0.02) return 'éå¸¸é«˜ç²¾åº¦ï¼Œè¯¯å·®å¾ˆå°';
            if (error < 0.05) return 'é«˜ç²¾åº¦ï¼Œè¯¯å·®åœ¨å¯æ¥å—èŒƒå›´å†…';
            if (error < 0.15) return 'ä¸­ç­‰ç²¾åº¦ï¼Œé€‚ç”¨äºå¤§å¤šæ•°åˆ†æ';
            return 'è¾ƒä½ç²¾åº¦ï¼Œå»ºè®®å¢åŠ éšç§å‚æ•°æˆ–ä½¿ç”¨æ›´å¤§æ•°æ®é›†';
        }
        
        // è·å–éšç§æè¿°
        function getPrivacyDescription(epsilon) {
            if (epsilon <= 0.5) return 'æå¼ºéšç§ä¿æŠ¤ï¼Œå‡ ä¹æ— æ³•æ¨æ–­ä¸ªä½“ä¿¡æ¯';
            if (epsilon <= 1.0) return 'å¼ºéšç§ä¿æŠ¤ï¼Œä¸ªä½“ä¿¡æ¯å¾—åˆ°å¾ˆå¥½ä¿æŠ¤';
            if (epsilon <= 2.0) return 'ä¸­ç­‰éšç§ä¿æŠ¤ï¼Œåœ¨éšç§å’Œæ•ˆç”¨é—´å–å¾—å¹³è¡¡';
            if (epsilon <= 3.0) return 'è¾ƒå¼±éšç§ä¿æŠ¤ï¼Œé‡ç‚¹å…³æ³¨æ•°æ®æ•ˆç”¨';
            return 'å¼±éšç§ä¿æŠ¤ï¼Œä¸»è¦ç”¨äºå†…éƒ¨åˆ†æ';
        }
        
        // è·å–å»ºè®®
        function getRecommendation(error, epsilon) {
            if (error > 0.15 && epsilon < 1.0) {
                return 'è¯¯å·®è¾ƒå¤§ï¼Œå»ºè®®é€‚å½“å¢åŠ éšç§å‚æ•°Îµä»¥æé«˜ç²¾åº¦';
            } else if (error < 0.02 && epsilon > 2.0) {
                return 'ç²¾åº¦å¾ˆé«˜ï¼Œå¯ä»¥è€ƒè™‘é™ä½éšç§å‚æ•°Îµä»¥å¢å¼ºéšç§ä¿æŠ¤';
            } else {
                return 'å½“å‰é…ç½®åœ¨éšç§ä¿æŠ¤å’Œæ•°æ®æ•ˆç”¨é—´è¾¾åˆ°äº†è‰¯å¥½å¹³è¡¡';
            }
        }
        
        // æ¯”è¾ƒéšç§çº§åˆ«
        function comparePrivacyLevels() {
            if (!medicalData.length) {
                showNotification('âš ï¸ è¯·å…ˆç”Ÿæˆæ•°æ®é›†', 'warning');
                return;
            }
            
            const queryType = document.getElementById('queryType').value;
            const column = document.getElementById('column').value;
            const condition = document.getElementById('condition').value;
            
            const epsilons = [0.1, 0.5, 1.0, 2.0, 5.0];
            const results = [];
            
            const button = event.target;
            const originalText = button.innerHTML;
            button.innerHTML = '<span class="loading"></span>å¯¹æ¯”ä¸­...';
            button.disabled = true;
            
            setTimeout(() => {
                epsilons.forEach(epsilon => {
                    dpSystem.setEpsilon(epsilon);
                    const result = dpSystem.executeQuery(queryType, column, condition);
                    results.push({ epsilon, ...result });
                });
                
                displayComparisonResults(results, queryType, column, condition);
                
                // æ¢å¤åŸå§‹epsilonå€¼
                const originalEpsilon = document.getElementById('epsilon').value;
                dpSystem.setEpsilon(parseFloat(originalEpsilon));
                
                button.innerHTML = originalText;
                button.disabled = false;
                
                showNotification('âœ… éšç§çº§åˆ«å¯¹æ¯”å®Œæˆ', 'success');
            }, 1500);
        }
        
        // æ˜¾ç¤ºå¯¹æ¯”ç»“æœ
        function displayComparisonResults(results, queryType, column, condition) {
            let comparisonHTML = '<div class="results" style="grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));">';
            
            results.forEach(result => {
                const privacyLevel = result.epsilon <= 0.5 ? 'æå¼º' : 
                                   result.epsilon <= 1.0 ? 'å¼º' : 
                                   result.epsilon <= 2.0 ? 'ä¸­ç­‰' :
                                   result.epsilon <= 3.0 ? 'è¾ƒå¼±' : 'å¼±';
                const privacyColor = result.epsilon <= 0.5 ? '#e74c3c' : 
                                    result.epsilon <= 1.0 ? '#f39c12' : 
                                    result.epsilon <= 2.0 ? '#3498db' :
                                    result.epsilon <= 3.0 ? '#95a5a6' : '#27ae60';
                
                comparisonHTML += `
                    <div class="result-card" style="border-top-color: ${privacyColor}">
                        <h3 style="color: ${privacyColor}">Îµ = ${result.epsilon} (${privacyLevel}éšç§)</h3>
                        <div class="result-item">
                            <span class="result-label">çœŸå®å€¼:</span>
                            <span class="result-value true-value">${formatNumber(result.trueResult)}</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">ä¿æŠ¤å€¼:</span>
                            <span class="result-value private-value">${formatNumber(result.privateResult)}</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">ç›¸å¯¹è¯¯å·®:</span>
                            <span class="result-value error-value">${(result.relativeError * 100).toFixed(2)}%</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">æ•æ„Ÿåº¦:</span>
                            <span class="result-value">${result.sensitivity.toFixed(3)}</span>
                        </div>
                        <div style="margin-top: 10px;">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${Math.min(100, result.relativeError * 300)}%; background: ${privacyColor};"></div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            comparisonHTML += '</div>';
            comparisonHTML += `
                <div class="alert alert-info" style="margin-top: 20px;">
                    <strong>å¯¹æ¯”åˆ†æï¼š</strong>ä»å·¦åˆ°å³éšç§ä¿æŠ¤å¼ºåº¦é€’å‡ï¼ŒæŸ¥è¯¢ç²¾åº¦é€’å¢ã€‚
                    é€‰æ‹©åˆé€‚çš„Îµå€¼éœ€è¦åœ¨éšç§ä¿æŠ¤å’Œæ•°æ®æ•ˆç”¨ä¹‹é—´æ‰¾åˆ°æœ€ä½³å¹³è¡¡ç‚¹ã€‚
                </div>
            `;
            
            document.getElementById('queryResults').innerHTML = comparisonHTML;
            updatePrivacyTrendChart(results);
        }
        
        // æ˜¾ç¤ºéšç§è¶‹åŠ¿
        function showPrivacyTrend() {
            if (!medicalData.length) {
                showNotification('âš ï¸ è¯·å…ˆç”Ÿæˆæ•°æ®é›†', 'warning');
                return;
            }
            
            const queryType = document.getElementById('queryType').value;
            const column = document.getElementById('column').value;
            const condition = document.getElementById('condition').value;
            
            const epsilons = [];
            for (let e = 0.1; e <= 5.0; e += 0.2) {
                epsilons.push(parseFloat(e.toFixed(1)));
            }
            
            const button = event.target;
            const originalText = button.innerHTML;
            button.innerHTML = '<span class="loading"></span>åˆ†æä¸­...';
            button.disabled = true;
            
            setTimeout(() => {
                const trendData = [];
                
                epsilons.forEach(epsilon => {
                    dpSystem.setEpsilon(epsilon);
                    
                    // å¤šæ¬¡æŸ¥è¯¢å–å¹³å‡å€¼å‡å°‘å™ªå£°å½±å“
                    let totalError = 0;
                    const iterations = 5;
                    
                    for (let i = 0; i < iterations; i++) {
                        const result = dpSystem.executeQuery(queryType, column, condition);
                        totalError += result.relativeError;
                    }
                    
                    const avgError = totalError / iterations;
                    trendData.push({ epsilon, error: avgError });
                });
                
                displayTrendAnalysis(trendData, queryType, column, condition);
                
                // æ¢å¤åŸå§‹epsilonå€¼
                const originalEpsilon = document.getElementById('epsilon').value;
                dpSystem.setEpsilon(parseFloat(originalEpsilon));
                
                button.innerHTML = originalText;
                button.disabled = false;
                
                showTab('charts');
                showNotification('âœ… è¶‹åŠ¿åˆ†æå®Œæˆ', 'success');
            }, 2000);
        }
        
        // æ˜¾ç¤ºè¶‹åŠ¿åˆ†æ
        function displayTrendAnalysis(trendData, queryType, column, condition) {
            updatePrivacyTrendChart(trendData);
            
            const optimalPoint = findOptimalPrivacyPoint(trendData);
            const resultHTML = `
                <div class="result-card">
                    <h3>ğŸ“ˆ éšç§-æ•ˆç”¨è¶‹åŠ¿åˆ†æ</h3>
                    <div class="alert alert-info">
                        <strong>åˆ†æç»“æœï¼š</strong><br>
                        â€¢ æœ€ä¼˜éšç§å‚æ•°ï¼šÎµ â‰ˆ ${optimalPoint.epsilon}<br>
                        â€¢ æ­¤æ—¶ç›¸å¯¹è¯¯å·®ï¼š${(optimalPoint.error * 100).toFixed(2)}%<br>
                        â€¢ å»ºè®®åœ¨ ${Math.max(0.1, optimalPoint.epsilon - 0.5).toFixed(1)} ~ ${Math.min(5.0, optimalPoint.epsilon + 0.5).toFixed(1)} èŒƒå›´å†…é€‰æ‹©å‚æ•°
                    </div>
                    <p>æ›²çº¿æ˜¾ç¤ºäº†éšç§å‚æ•°Îµä¸æŸ¥è¯¢è¯¯å·®çš„å…³ç³»ã€‚Îµå€¼è¶Šå°ï¼Œéšç§ä¿æŠ¤è¶Šå¼ºä½†è¯¯å·®è¶Šå¤§ï¼›Îµå€¼è¶Šå¤§ï¼Œéšç§ä¿æŠ¤è¶Šå¼±ä½†ç»“æœè¶Šå‡†ç¡®ã€‚</p>
                </div>
            `;
            
            document.getElementById('queryResults').innerHTML = resultHTML;
        }
        
        // æ‰¾åˆ°æœ€ä¼˜éšç§ç‚¹
        function findOptimalPrivacyPoint(trendData) {
            // å¯»æ‰¾è¯¯å·®ä¸‹é™å¹…åº¦å¼€å§‹å˜ç¼“çš„æ‹ç‚¹
            let optimalPoint = trendData[Math.floor(trendData.length / 2)];
            let minSlope = Infinity;
            
            for (let i = 1; i < trendData.length - 1; i++) {
                const slope = Math.abs(trendData[i + 1].error - trendData[i - 1].error) / 
                             (trendData[i + 1].epsilon - trendData[i - 1].epsilon);
                
                if (slope < minSlope && trendData[i].error < 0.1) {
                    minSlope = slope;
                    optimalPoint = trendData[i];
                }
            }
            
            return optimalPoint;
        }
        
        // æ¸…é™¤ç»“æœ
        function clearResults() {
            document.getElementById('queryResults').innerHTML = `
                <div class="result-card">
                    <h3>ğŸ’¡ ä½¿ç”¨è¯´æ˜</h3>
                    <div class="alert alert-info">
                        <strong>å¼€å§‹ä½¿ç”¨ï¼š</strong><br>
                        1. é¦–å…ˆç‚¹å‡»"ç”Ÿæˆæ–°æ•°æ®é›†"åˆ›å»ºæ¨¡æ‹ŸåŒ»ç–—æ•°æ®<br>
                        2. è°ƒæ•´éšç§å‚æ•°Îµå’ŒæŸ¥è¯¢é…ç½®<br>
                        3. ç‚¹å‡»"æ‰§è¡ŒæŸ¥è¯¢"æŸ¥çœ‹ç»“æœ<br>
                        4. å°è¯•ä¸åŒçš„éšç§çº§åˆ«å¯¹æ¯”æ•ˆæœ
                    </div>
                </div>
            `;
            
            // æ¸…ç©ºå›¾è¡¨
            if (charts.privacy) {
                charts.privacy.destroy();
                charts.privacy = null;
            }
            if (charts.distribution) {
                charts.distribution.destroy();
                charts.distribution = null;
            }
            
            // é‡ç½®éšç§é¢„ç®—
            privacyBudgetUsed = 0;
            updatePrivacyBudget();
            
            showNotification('ğŸ—‘ï¸ ç»“æœå·²æ¸…é™¤', 'info');
        }
        
        // æ·»åŠ åˆ°å†å²è®°å½•
        function addToHistory(result, queryType, column, condition) {
            const historyItem = {
                timestamp: new Date().toLocaleString(),
                queryType,
                column,
                condition,
                epsilon: dpSystem.epsilon,
                result
            };
            
            queryHistory.unshift(historyItem);
            if (queryHistory.length > 10) {
                queryHistory = queryHistory.slice(0, 10);
            }
            
            updateHistoryDisplay();
        }
        
        // æ›´æ–°å†å²æ˜¾ç¤º
        function updateHistoryDisplay() {
            const historyContainer = document.getElementById('queryHistory');
            
            if (queryHistory.length === 0) {
                historyContainer.innerHTML = '<p class="text-muted">æš‚æ— æŸ¥è¯¢å†å²è®°å½•ã€‚</p>';
                return;
            }
            
            let historyHTML = '';
            queryHistory.forEach((item, index) => {
                const queryTypeNames = {
                    'count': 'è®¡æ•°',
                    'mean': 'å¹³å‡å€¼',
                    'sum': 'æ±‚å’Œ',
                    'min': 'æœ€å°å€¼',
                    'max': 'æœ€å¤§å€¼'
                };
                
                historyHTML += `
                    <div class="result-card" style="margin-bottom: 15px;">
                        <h4>#${index + 1} - ${item.timestamp}</h4>
                        <div class="result-item">
                            <span class="result-label">æŸ¥è¯¢:</span>
                            <span>${queryTypeNames[item.queryType]} (Îµ=${item.epsilon})</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">ç»“æœ:</span>
                            <span>${formatNumber(item.result.privateResult)} (è¯¯å·®: ${(item.result.relativeError * 100).toFixed(2)}%)</span>
                        </div>
                    </div>
                `;
            });
            
            historyContainer.innerHTML = historyHTML;
        }
        
        // æ›´æ–°ç»“æœè§£é‡Š
        function updateResultExplanation(result, queryType, column, condition) {
            const explanationContainer = document.getElementById('resultExplanation');
            
            const explanationHTML = `
                <h3>ğŸ¯ æŸ¥è¯¢ç»“æœè§£é‡Š</h3>
                <div class="alert alert-info">
                    <strong>æœ¬æ¬¡æŸ¥è¯¢è¯¦æƒ…ï¼š</strong><br>
                    æŸ¥è¯¢ç±»å‹ï¼š${queryType}<br>
                    éšç§å‚æ•°ï¼šÎµ = ${dpSystem.epsilon}<br>
                    å…¨å±€æ•æ„Ÿåº¦ï¼š${result.sensitivity.toFixed(3)}<br>
                    æ·»åŠ çš„å™ªå£°å°ºåº¦ï¼š${(result.sensitivity / dpSystem.epsilon).toFixed(3)}
                </div>
                
                <h4>ğŸ” ç»“æœåˆ†æ</h4>
                <p><strong>çœŸå®å€¼ vs éšç§ä¿æŠ¤å€¼ï¼š</strong></p>
                <p>çœŸå®æŸ¥è¯¢ç»“æœä¸º ${formatNumber(result.trueResult)}ï¼Œæ·»åŠ æ‹‰æ™®æ‹‰æ–¯å™ªå£°åå¾—åˆ°éšç§ä¿æŠ¤å€¼ ${formatNumber(result.privateResult)}ã€‚</p>
                
                <p><strong>è¯¯å·®åˆ†æï¼š</strong></p>
                <p>ç›¸å¯¹è¯¯å·®ä¸º ${(result.relativeError * 100).toFixed(2)}%ï¼Œ${result.relativeError < 0.05 ? 'å±äºé«˜ç²¾åº¦èŒƒå›´' : result.relativeError < 0.15 ? 'å±äºä¸­ç­‰ç²¾åº¦èŒƒå›´' : 'è¯¯å·®è¾ƒå¤§ï¼Œå»ºè®®è°ƒæ•´å‚æ•°'}ã€‚</p>
                
                <p><strong>éšç§ä¿æŠ¤åˆ†æï¼š</strong></p>
                <p>å½“å‰Îµ=${dpSystem.epsilon}ï¼Œ${getPrivacyDescription(dpSystem.epsilon)}ã€‚å³ä½¿æ”»å‡»è€…çŸ¥é“é™¤æŸä¸ªæ‚£è€…å¤–æ‰€æœ‰å…¶ä»–æ‚£è€…çš„å®Œæ•´ä¿¡æ¯ï¼Œä¹Ÿæ— æ³•é€šè¿‡æŸ¥è¯¢ç»“æœæ¨æ–­å‡ºè¯¥æ‚£è€…çš„æ•æ„Ÿä¿¡æ¯ã€‚</p>
                
                <h4>ğŸ›¡ï¸ å·®åˆ†éšç§æœºåˆ¶</h4>
                <p>ç³»ç»Ÿä½¿ç”¨æ‹‰æ™®æ‹‰æ–¯æœºåˆ¶å®ç°å·®åˆ†éšç§ä¿æŠ¤ï¼š</p>
                <ol>
                    <li><strong>æ•æ„Ÿåº¦è®¡ç®—ï¼š</strong>åˆ†ææŸ¥è¯¢å‡½æ•°å¯¹å•ä¸ªè®°å½•å˜åŒ–çš„æ•æ„Ÿç¨‹åº¦</li>
                    <li><strong>å™ªå£°ç”Ÿæˆï¼š</strong>æ ¹æ®æ•æ„Ÿåº¦å’Œéšç§å‚æ•°ç”Ÿæˆæ‹‰æ™®æ‹‰æ–¯åˆ†å¸ƒå™ªå£°</li>
                    <li><strong>ç»“æœæ‰°åŠ¨ï¼š</strong>å°†å™ªå£°æ·»åŠ åˆ°çœŸå®æŸ¥è¯¢ç»“æœä¸Š</li>
                </ol>
                
                <p>è¿™ç§æ–¹æ³•ç¡®ä¿äº†ä¸¥æ ¼çš„æ•°å­¦éšç§ä¿è¯ï¼Œå³æ»¡è¶³Îµ-å·®åˆ†éšç§å®šä¹‰ã€‚</p>
                
                <div class="alert alert-warning">
                    <strong>æ³¨æ„ï¼š</strong>æ¯æ¬¡æŸ¥è¯¢éƒ½ä¼šæ¶ˆè€—éšç§é¢„ç®—ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œéœ€è¦åˆç†åˆ†é…éšç§é¢„ç®—ï¼Œé¿å…è¿‡åº¦æŸ¥è¯¢å¯¼è‡´éšç§ä¿æŠ¤å¤±æ•ˆã€‚
                </div>
            `;
            
            explanationContainer.innerHTML = explanationHTML;
        }
        
        // æ›´æ–°éšç§é¢„ç®—ä½¿ç”¨
        function updatePrivacyBudgetUsage() {
            privacyBudgetUsed += parseFloat(document.getElementById('epsilon').value);
            updatePrivacyBudget();
        }
        
        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `alert alert-${type}`;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 10000;
                max-width: 300px;
                opacity: 0;
                transform: translateX(100%);
                transition: all 0.3s ease;
            `;
            notification.innerHTML = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '1';
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }
        
        // æ ‡ç­¾é¡µåˆ‡æ¢
        function showTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾é¡µå†…å®¹
            document.querySelectorAll('.tab-panel').forEach(panel => {
                panel.classList.add('hidden');
            });
            
            // ç§»é™¤æ‰€æœ‰æ ‡ç­¾çš„æ´»åŠ¨çŠ¶æ€
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾é¡µ
            document.getElementById(tabName + '-tab').classList.remove('hidden');
            
            // æ¿€æ´»å¯¹åº”æ ‡ç­¾
            event.target.classList.add('active');
        }
        
        // æ›´æ–°éšç§è¶‹åŠ¿å›¾è¡¨
        function updatePrivacyTrendChart(data) {
            const ctx = document.getElementById('privacyChart').getContext('2d');
            
            if (charts.privacy) {
                charts.privacy.destroy();
            }
            
            charts.privacy = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map(d => d.epsilon || d.epsilon),
                    datasets: [{
                        label: 'ç›¸å¯¹è¯¯å·® (%)',
                        data: data.map(d => (d.error || d.relativeError) * 100),
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#2980b9',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'éšç§å‚æ•° Îµ',
                                font: { weight: 'bold' }
                            },
                            grid: { color: 'rgba(0,0,0,0.1)' }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'ç›¸å¯¹è¯¯å·® (%)',
                                font: { weight: 'bold' }
                            },
                            grid: { color: 'rgba(0,0,0,0.1)' },
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0,0,0,0.8)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            callbacks: {
                                title: function(context) {
                                    return `éšç§å‚æ•° Îµ = ${context[0].label}`;
                                },
                                label: function(context) {
                                    return `ç›¸å¯¹è¯¯å·®: ${context.parsed.y.toFixed(2)}%`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // æ›´æ–°åˆ†å¸ƒå›¾è¡¨
        function updateDistributionChart() {
            if (!medicalData.length) return;
            
            const ctx = document.getElementById('distributionChart').getContext('2d');
            
            if (charts.distribution) {
                charts.distribution.destroy();
            }
            
            // ç»Ÿè®¡å¹´é¾„åˆ†å¸ƒ
            const ageRanges = ['18-30', '31-40', '41-50', '51-60', '61-70', '70+'];
            const ageCounts = [0, 0, 0, 0, 0, 0];
            
            medicalData.forEach(patient => {
                const age = patient.age;
                if (age <= 30) ageCounts[0]++;
                else if (age <= 40) ageCounts[1]++;
                else if (age <= 50) ageCounts[2]++;
                else if (age <= 60) ageCounts[3]++;
                else if (age <= 70) ageCounts[4]++;
                else ageCounts[5]++;
            });
            
            charts.distribution = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ageRanges,
                    datasets: [{
                        label: 'æ‚£è€…æ•°é‡',
                        data: ageCounts,
                        backgroundColor: [
                            'rgba(52, 152, 219, 0.8)',
                            'rgba(46, 204, 113, 0.8)',
                            'rgba(241, 196, 15, 0.8)',
                            'rgba(231, 76, 60, 0.8)',
                            'rgba(155, 89, 182, 0.8)',
                            'rgba(149, 165, 166, 0.8)'
                        ],
                        borderColor: [
                            '#3498db',
                            '#2ecc71',
                            '#f1c40f',
                            '#e74c3c',
                            '#9b59b6',
                            '#95a5a6'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'å¹´é¾„èŒƒå›´',
                                font: { weight: 'bold' }
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'æ‚£è€…æ•°é‡',
                                font: { weight: 'bold' }
                            },
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0,0,0,0.8)',
                            callbacks: {
                                title: function(context) {
                                    return `å¹´é¾„æ®µ: ${context[0].label}å²`;
                                },
                                label: function(context) {
                                    const total = ageCounts.reduce((a, b) => a + b, 0);
                                    const percentage = (context.parsed.y / total * 100).toFixed(1);
                                    return `æ‚£è€…æ•°: ${context.parsed.y} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // æ˜¾ç¤ºæ•°æ®è¯¦æƒ…
        function showDataDetail(type) {
            // è¿™é‡Œå¯ä»¥æ·»åŠ æ›´è¯¦ç»†çš„æ•°æ®å±•ç¤ºé€»è¾‘
            console.log(`æ˜¾ç¤º${type}çš„è¯¦ç»†ä¿¡æ¯`);
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            initSystem();
            
            // é»˜è®¤æ˜¾ç¤ºç»“æœæ ‡ç­¾é¡µ
            document.querySelector('.tab[onclick="showTab(\'results\')"]').classList.add('active');
            document.getElementById('results-tab').classList.remove('hidden');
        };
    </script>
</body>
</html>